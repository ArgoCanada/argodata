---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  dpi = 300
)

library(argodata)
library(tidyverse)

argo_set_cache_dir("cache-dev")
options(argodata.max_global_cache_age = Inf)
options(argodata.max_data_cache_age = Inf)

argo_global_prof()
```

# argodata

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![R build status](https://github.com/ArgoCanada/argodata/workflows/R-CMD-check/badge.svg)](https://github.com/ArgoCanada/argodata/actions)
[![Codecov test coverage](https://codecov.io/gh/ArgoCanada/argodata/branch/master/graph/badge.svg)](https://codecov.io/gh/ArgoCanada/argodata?branch=master)
<!-- badges: end -->

The goal of argodata is to provide a data frame-based interface to data generated by the [Argo floats program](https://argo.ucsd.edu/).

## Installation

You can install the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("ArgoCanada/argodata")
```

The argodata package downloads files from the [FTP and HTTPS mirrors](http://www.argodatamgt.org/Access-to-data/Access-via-FTP-or-HTTPS-on-GDAC), caches them, and loads them into R. You can set the mirror using `argo_set_mirror()` and the cache directory using `argo_set_cache_dir()`:

```{r, eval = FALSE}
argo_set_mirror("https://data-argo.ifremer.fr/")
argo_set_cache_dir("my/argo/cache")
```

Optionally, you can set `options(argodata.cache_dir = "my/argo/cache")` in your .Rprofile to persist this value between R sessions (see `usethis::edit_r_profile()`). Cached files are used indefinitely by default because of the considerable time it takes to refresh them. If you do use a persistent cache, you should at least update the index files regularly using `argo_update_global()` (data files are also updated occasionally; update these using `argo_update_data()`).

## Example

```{r example}
library(tidyverse)
library(argodata)

# search for profiles that match some criteria
(prof_ns_may_2020 <-  argo_global_prof() %>% 
  filter(
    latitude >= 50, latitude <= 60,
    longitude >= -60, longitude <= -50,
    lubridate::year(date) == 2020, 
    lubridate::month(date) == 5
  ))

# downloads, caches, and reads the NetCDF files
(levels_ns_may_2020 <- prof_ns_may_2020 %>% 
  argo_prof_levels() )

# plot!
levels_ns_may_2020 %>% 
  filter(psal_qc == 1) %>% 
  ggplot(aes(x = psal, y = pres, col = temp)) +
  geom_point() +
  scale_y_reverse() +
  theme_bw()
```

In RStudio, you can use the [leaflet](https://rstudio.github.io/leaflet/) package to view locations of profiles interactively.

```{r, eval=FALSE}
library(leaflet)

prof_ns_may_2020 %>% 
  leaflet() %>% 
  addTiles() %>% 
  addMarkers(lng = ~longitude, lat = ~latitude, label = ~file)
```

![Leaflet Widget](man/figures/README-leaflet.png)
