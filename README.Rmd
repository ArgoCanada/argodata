---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  dpi = 300
)

library(argodata)
library(tidyverse)
argo_set_cache_dir("cache-dev")
options(argodata.max_global_cache_age = Inf)
options(argodata.max_data_cache_age = Inf)

argo_global_meta()
argo_global_prof()
argo_global_tech()
argo_global_traj()
```

# argodata

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![R build status](https://github.com/ArgoCanada/argodata/workflows/R-CMD-check/badge.svg)](https://github.com/ArgoCanada/argodata/actions)
[![Codecov test coverage](https://codecov.io/gh/ArgoCanada/argodata/branch/master/graph/badge.svg)](https://codecov.io/gh/ArgoCanada/argodata?branch=master)
<!-- badges: end -->

The goal of argodata is to provide a data frame-based interface to data generated by the [Argo floats program](https://argo.ucsd.edu/).

## Installation

You can install the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("ArgoCanada/argodata")
```

If you can load the package, you're all set!

```{r}
library(argodata)
```

## Example

The argodata package downloads files from the [FTP and HTTPS mirrors](http://www.argodatamgt.org/Access-to-data/Access-via-FTP-or-HTTPS-on-GDAC), caches them, and loads them into R. The `argo_global_*()` functions load the index files that list the locations of other files on the mirror:

```{r}
argo_global_meta()
argo_global_prof()
argo_global_tech()
argo_global_traj()
```

You can load profile data by filtering `argo_global_prof()` and piping to `argo_prof()`:

```{r}
argo_global_prof() %>% 
  tail(100) %>% 
  argo_prof()
```

If you have previously downloaded Argo data, you can use `argo_read_*()` functions:

```{r}
argo_read_global_meta("cache-dev/ar_index_global_meta.txt.gz")
argo_read_prof("cache-dev/dac/nmdis/2901633/profiles/R2901633_070.nc")
```

Documentation for Argo variable names, units, and more are available from the [Argo Data Management Documentation page](http://www.argodatamgt.org/Documentation).

## Cache management

Each Argo floats mirror is home to over 250 GB of data organized in millions of files! The argodata package caches all files that it downloads, which you can set to a cache that persists between sessions. If you have a [local mirror updated using rsync](http://www.argodatamgt.org/Access-to-data/Argo-GDAC-synchronization-service) you can pass this directory to `argo_set_mirror()`, which can also be used to switch between the various mirrors provided by GDAC.

```{r, eval=FALSE}
argo_set_cache_dir("path/to/cache")
argo_set_mirror("ftp://usgodae.org/pub/outgoing/argo")
argo_set_mirror("path/to/local/argo")
```

By default, index files are cached for 24 hours and data files are cached indefinitely. These defaults reflect a balance between the considerable time required to download new files and the frequency with which files are updated on the mirror. To override these defaults you can pass `download = TRUE` to functions that load data, or set `options(argodata.max_data_cache_age = 3)`, where the number is in hours. Use `Inf` to always use the cached version of a file.

```{r, eval=FALSE}
argo_global_prof(download = TRUE)
options(argodata.max_global_cache_age = Inf)
options(argodata.max_data_cache_age = Inf)
```
